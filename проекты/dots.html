<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        td {
            border: 1px solid grey;
        }

        h3 {
            height: 40px;
        }

        .black {
            background-color: rgb(0, 0, 0);
        }

        .red {
            background-color: rgb(255, 0, 0);
        }

        .empty {
            background-color: rgba(0, 0, 0, 0);
        }
    </style>
</head>
<body>

</body>
<script>

    var cellSize = 20;//размер ячейки
    var windowWidth = Math.floor(document.documentElement.clientWidth / cellSize); //количество столбцов
    var windowHeight = Math.floor(document.documentElement.clientHeight / cellSize) - 10; //количество рядов
    console.log(windowWidth);
    console.log(windowHeight);
    var tdBlack = true;
    var h3 = document.createElement('h3');// заголовок для вывода результата
    h3.innerHTML = 'Черные начинают';
    document.body.appendChild(h3); //
    var table = document.createElement('table'); //строим таблицу
    document.body.appendChild(table);
    for (var i = 1; i <= windowHeight; i++) {
        var tr = document.createElement('tr');
        tr.style.height = cellSize + 'px';
        for (var j = 1; j <= windowWidth; j++) {
            var td = document.createElement('td');
            td.style.width = cellSize + 'px';
            td.dataset.y = i; // присваиваем ячейке координату y
            td.dataset.x = j; // присваиваем ячейке координату х
            td.classList.add('empty');
            td.addEventListener('click', func.bind(td));//режим заполнения
            td.addEventListener('click', check.bind(td));//проверка
            tr.appendChild(td);
        }
        table.appendChild(tr);
    }
    //режим заполнения ячейки цветом
    function func() {
        if (this.classList.contains('empty')) {
            this.classList.remove('empty');
            if (tdBlack) {
                this.classList.add('black');
                tdBlack = false;
            }
            else {
                this.classList.add('red');
                tdBlack = true;
            }
        }
        else {
            console.log(this.classList.contains('empty'));
        }
    }
    //проверка
    function check() {
        console.clear();
        var checkResult; //контрольная переменная для проверки
        var elemClass; // класс ячейки
        //начало проверки по горизонтали
        for (var i = 1; i <= (windowWidth - 4); i++) {
            for (j = 1; j <= windowHeight; j++) {
                checkResult = 1;
                var elem = table.querySelector('[data-x = \'' + i + '\'][data-y = \'' + j + '\']');
                if (elem.classList.contains('black')) {
                    elemClass = 'black';
                }
                else {
                    elemClass = 'red';
                }
                if (!elem.classList.contains('empty')) {
                    //  console.log(elem.dataset.x + ' ' + elem.dataset.y + ' ' + elemClass);
                    for (s = 1; s < 5; s++) {
                        var elemNew = table.querySelector('[data-x = \'' + (i + s) + '\'][data-y = \'' + j + '\']');
                        if (elemNew.classList.contains(elemClass)) {
                            checkResult++;
                            //  console.log(elemNew.dataset.x + ' ' + elemNew.dataset.y + ' ' + elemClass + ' ' + checkResult);
                            if (checkResult == 5) {
                                window.setTimeout(end.bind(this), 500);
                            }
                        }
                    }
                }
            }
        }
        //конец проверки по горизонтали
        //начало проверки по вертикали
        for (var i = 1; i <= (windowHeight - 4); i++) {
            for (j = 1; j <= windowWidth; j++) {
                checkResult = 1;
                var elem = table.querySelector('[data-x = \'' + j + '\'][data-y = \'' + i + '\']');
                if (elem.classList.contains('black')) {
                    elemClass = 'black';
                }
                else {
                    elemClass = 'red';
                }
                if (!elem.classList.contains('empty')) {
                    // console.log(elem.dataset.x + ' ' + elem.dataset.y + ' ' + elemClass);
                    for (s = 1; s < 5; s++) {
                        var elemNew = table.querySelector('[data-x = \'' + j + '\'][data-y = \'' + (i + s) + '\']');
                        if (elemNew.classList.contains(elemClass)) {
                            checkResult++;
                            //  console.log(elemNew.dataset.x + ' ' + elemNew.dataset.y + ' ' + elemClass + ' ' + checkResult);
                            if (checkResult == 5) {
                                window.setTimeout(end.bind(this), 500);
                            }
                        }
                    }
                }
            }
        }
        //конец проверки по вертикали
        //начало проверки по диагонали вниз вправо
        for (var i = 1; i <= (windowHeight - 4); i++) {
            for (j = 1; j <= (windowWidth - 4); j++) {
                checkResult = 1;
                var elem = table.querySelector('[data-x = \'' + j + '\'][data-y = \'' + i + '\']');
                if (elem.classList.contains('black')) {
                    elemClass = 'black';
                }
                else {
                    elemClass = 'red';
                }
                if (!elem.classList.contains('empty')) {
                    //  console.log(elem.dataset.x + ' ' + elem.dataset.y + ' ' + elemClass);
                    for (s = 1; s < 5; s++) {
                        var elemNew = table.querySelector('[data-x = \'' + (j + s) + '\'][data-y = \'' + (i + s) + '\']');
                        if (elemNew.classList.contains(elemClass)) {
                            checkResult++;
                            //  console.log(elemNew.dataset.x + ' ' + elemNew.dataset.y + ' ' + elemClass + ' ' + checkResult);
                            if (checkResult == 5) {
                                window.setTimeout(end.bind(this), 500);
                            }
                        }
                    }
                }
            }
        }
        //конец проверки по диагонали вниз вправо
        //начало проверки по диагонали вверх вправо
        for (var i = 5; i <= (windowHeight); i++) {
            for (j = 5; j <= (windowWidth); j++) {
                checkResult = 1;
                var elem = table.querySelector('[data-x = \'' + j + '\'][data-y = \'' + i + '\']');
                if (elem.classList.contains('black')) {
                    elemClass = 'black';
                }
                else {
                    elemClass = 'red';
                }
                if (!elem.classList.contains('empty')) {
                    // console.log(elem.dataset.x + ' ' + elem.dataset.y + ' ' + elemClass);
                    for (s = 1; s < 5; s++) {
                        var elemNew = table.querySelector('[data-x = \'' + (j + s) + '\'][data-y = \'' + (i - s) + '\']');
                        if (elemNew.classList.contains(elemClass)) {
                            checkResult++;
                            // console.log(elemNew.dataset.x + ' ' + elemNew.dataset.y + ' ' + elemClass + ' ' + checkResult);
                            if (checkResult == 5) {
                                window.setTimeout(end.bind(this), 500);
                            }
                        }
                    }
                }
            }
        }
        //конец проверки по диагонали вверх вправо
    }

    //конец игры
    function end() {
        h3.innerHTML = '';
        checkResult = 0;
        checkResultCross = 0;
        if (this.classList.contains('black')) {
            h3.innerHTML = 'Черные выиграли<br>Красные начинают';
        }
        else {
            h3.innerHTML = 'Красные выиграли<br>Черные начинают';
        }
        var td = table.querySelectorAll('td');
        for (var i = 0; i < td.length; i++) {
            if (td[i].classList.contains('black')) {
                td[i].classList.remove('black');
                td[i].classList.add('empty');
            }
            if (td[i].classList.contains('red')) {
                td[i].classList.remove('red');
                td[i].classList.add('empty');
            }
        }
    }

</script>
</html>